angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","ngBaiduMap","ngDialog","smart-table"]).constant("baseUrl","http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD").constant("baiduUrl","http://api.map.baidu.com/geocoder/v2/?callback=renderReverse&output=json&ak=nhB87EF7jEp0diMOOTjHkXYyHQwGKojT").constant("bmapUrl","http://api.map.baidu.com/staticimage/v2?ak=nhB87EF7jEp0diMOOTjHkXYyHQwGKojT");
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("index",{url:"/",templateUrl:"templates/dashboard.html"}).state("tables",{url:"/tables",templateUrl:"templates/tables.html"}).state("user",{url:"/user",controller:"UserCtrl",templateUrl:"templates/user-manager.html",cache:!1}).state("lot",{url:"/lot",controller:"LotCtrl",templateUrl:"templates/park-lot.html",cache:!1}).state("space",{url:"/space",controller:"SpaceCtrl",templateUrl:"templates/park-space.html",params:{id:0,num:0,x:0,y:0},cache:!1}).state("order",{url:"/order",controller:"OrderCtrl",templateUrl:"templates/park-order.html"}).state("qrCode",{url:"/qrCode",controller:"QRCtrl",templateUrl:"templates/qrcode.html",params:{id:0}}).state("addlot",{url:"/addlot",controller:"AddLotCtrl",templateUrl:"templates/addlot.html"}).state("entry",{url:"/entry",controller:"EntryCtrl",templateUrl:"templates/park-entry.html",params:{id:0},cache:!1}).state("addEntry",{url:"/addEntry",controller:"AddEntryCtrl",templateUrl:"templates/addentry.html",params:{id:0}}).state("editLot",{url:"/editLot",controller:"EditLotCtrl",templateUrl:"templates/editlot.html",params:{id:0}}).state("addUser",{url:"/addUser",controller:"AddUserCtrl",templateUrl:"templates/adduser.html"})}]);
function AddEntryCtrl(t,e,r){t.parkid=r.id,console.log(t.parkid),t.createEntry=function(){if(console.log(t.entryx),console.log(t.entryy),t.parkid&&t.entryx&&t.entryy){var r={parkid:t.parkid,x:parseInt(t.entryx),y:parseInt(t.entryy)};console.log(r),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkentry/",method:"POST",async:!1,data:JSON.stringify(r),contentType:"application/json",success:function(r){r&&(console.log(r),alert("create entry success!"),e.go("entry",{id:t.parkid}))}})}else alert("关键信息为空")}}angular.module("RDash").controller("AddEntryCtrl",["$scope","$state","$stateParams",AddEntryCtrl]);
function AddLotCtrl(n,o){function t(){function o(n,o){var e=new BMap.Marker(new BMap.Point(n,o));t.addOverlay(e),e.disableDragging()}var t=new BMap.Map("allmap"),e=new BMap.Point(121.442869,31.032034);t.centerAndZoom(e,16),t.addEventListener("click",function(t){alert(t.point.lng+",纬度"+t.point.lat),console.log("选中位置：经度"+t.point.lng+",纬度"+t.point.lat),n.longi=t.point.lng,n.lat=t.point.lat,console.log("赋值后：经度"+n.longi+",纬度"+n.lat),o(t.point.lng,t.point.lat)});var a=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE,enableGeolocation:!0}),l=new BMap.GeolocationControl;l.addEventListener("locationSuccess",function(n){var o="";o+=n.addressComponent.province,o+=n.addressComponent.city,o+=n.addressComponent.district,o+=n.addressComponent.street,o+=n.addressComponent.streetNumber,alert("当前定位地址为："+o)}),l.addEventListener("locationError",function(n){alert(n.message)}),t.addControl(a),t.addControl(l)}t(),n.create=function(){console.log("创建停车场：经度"+n.longi+",纬度"+n.lat);var t={longitude:n.longi,latitude:n.lat,address:n.newlot.address,name:n.newlot.name,spacenum:parseInt(n.newlot.spacenum),hourcharge:parseInt(n.newlot.hourcharge),xpos:parseInt(n.newlot.xpos),ypos:parseInt(n.newlot.ypos),intro:n.newlot.intro};console.log(t),t.longitude&&t.latitude&&t.address&&t.name&&t.spacenum&&t.hourcharge&&t.xpos&&t.ypos&&t.intro?$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/",method:"POST",data:JSON.stringify(t),contentType:"application/json",async:!1,success:function(n){n&&(console.log(n),alert("success!"+n.id))}}).done(function(n){var t="http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/"+n.id;console.log(t);var e=$(":file")[0].files,a=new FormData;a.append("file",e[0]),$.ajax({url:t,type:"POST",data:a,contentType:!1,processData:!1,success:function(n){alert("success!"),console.log(n),o.go("lot")}})}):alert("关键信息不能为空！")}}angular.module("RDash").controller("AddLotCtrl",["$scope","$state",AddLotCtrl]);
function AddUserCtrl(e,r){e.createUser=function(){var a={username:e.create.username,phone:e.create.phone,password:e.create.password,cartype:e.create.cartype,carid:e.create.carid,money:0};console.log(a),a.username&&a.phone&&a.password&&a.cartype&&a.carid?$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/",method:"POST",async:!1,data:JSON.stringify(a),contentType:"application/json",success:function(e){e&&(console.log(e),alert("create user success!"),r.go("user"))}}):alert("关键信息为空！")}}angular.module("RDash").controller("AddUserCtrl",["$scope","$state",AddUserCtrl]);
function AlertsCtrl(t,e){t.alerts=[{type:"success",msg:"欢迎登陆停车场管理系统!"},{type:"danger",msg:"有问题或建议？"}],t.addAlert=function(){t.alerts.push({msg:"Another alert!"})},t.closeAlert=function(e){t.alerts.splice(e,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope","$state",AlertsCtrl]);
function EditLotCtrl(t,e,o){t.myid=o.id,console.log(t.myid),0!=t.myid&&$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/"+t.myid,method:"GET",async:!1,success:function(e){console.log(e),t.editLot=e}}),t.save=function(){if(t.editLot&&t.editLot.spacenum&&t.editLot.hourcharge&&t.editLot.xpos&&t.editLot.ypos&&t.editLot.intro){var o={id:parseInt(t.myid),longitude:parseFloat(t.editLot.longitude),latitude:parseFloat(t.editLot.latitude),address:t.editLot.address,name:t.editLot.name,spacenum:parseInt(t.editLot.spacenum),hourcharge:parseInt(t.editLot.hourcharge),xpos:parseInt(t.editLot.xpos),ypos:parseInt(t.editLot.ypos),intro:t.editLot.intro};$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/"+t.myid,method:"PUT",data:JSON.stringify(o),contentType:"application/json",async:!1,success:function(o){t.editLot=o,console.log(o),alert("update success!"),e.go("lot")}})}else alert("关键信息不能为空！")},t.updateImg=function(){var e="http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/"+t.myid;console.log(e);var o=$(":file")[0].files,a=new FormData;a.append("file",o[0]),$.ajax({url:e,type:"POST",data:a,contentType:!1,processData:!1,success:function(t){alert("success!"),console.log(t)}})}}angular.module("RDash").controller("EditLotCtrl",["$scope","$state","$stateParams",EditLotCtrl]);
function EntryCtrl(e,t,o){e.listshow=!0,e.listMessage="收起",e.parkid=o.id,console.log(e.parkid),0!=e.parkid&&$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkentry/?Parkentry.parkid="+e.parkid,method:"GET",async:!1,success:function(t){t.Parkentry&&(e.rowCollection=t.Parkentry,console.log(e.rowCollection))}}),e.goToAdd=function(){console.log(e.parkid),t.go("addEntry",{id:e.parkid})},e.search=function(){$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkentry/?Parkentry.parkid="+e.parkid,method:"GET",async:!1,success:function(t){t.Parkentry&&(e.rowCollection=t.Parkentry,console.log(e.rowCollection),alert("success!"))}})},e.changeView=function(){e.listshow=!e.listshow,e.listshow?e.listMessage="收起":e.listMessage="显示"},e.deleteEntry=function(t){var o=confirm("确认删除？");1==o?(console.log("delete"),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkentry/"+t.id,method:"DELETE",async:!1,success:function(e){alert(" delete success"),e.message&&(console.log(e),alert("success!"))}}).done(function(){var o=e.rowCollection.indexOf(t);o!==-1&&e.rowCollection.splice(o,1)})):console.log("cancel")},e.entryCode=function(e){t.go("qrCode",{id:e.id}),console.log(e.id)},e.createEntry=function(){if(console.log(e.entryx),console.log(e.entryy),e.parkid&&e.entryx&&e.entryy){var t={parkid:e.parkid,x:parseInt(e.entryx),y:parseInt(e.entryy)};console.log(t),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkentry/",method:"POST",async:!1,data:JSON.stringify(t),contentType:"application/json",success:function(e){e&&(console.log(e),alert("create entry success!"))}})}else alert("关键信息为空")}}angular.module("RDash").controller("EntryCtrl",["$scope","$state","$stateParams",EntryCtrl]);
function LotCtrl(o,e){o.listshow=!0,o.listMessage="收起",$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/",method:"GET",async:!1,success:function(e){e.Parklot&&(o.rowCollection=e.Parklot,o.lotnum=o.rowCollection.length,console.log(o.rowCollection))}}),o.changeView=function(){o.listshow=!o.listshow,o.listshow?o.listMessage="收起":o.listMessage="显示"},o.editLot=function(o){console.log(o.id),e.go("editLot",{id:o.id})},o.lotCode=function(o){console.log(o.id),e.go("qrCode",{id:o.id})},o.createEntry=function(o){console.log(o.id),e.go("entry",{id:o.id})},o.manage=function(o){console.log(o.id+","+o.spacenum+","+o.xpos+","+o.ypos),e.go("space",{id:o.id,num:o.spacenum,x:o.xpos,y:o.ypos})},o.search=function(){o.listshow=!0,o.listMessage="收起",$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/",method:"GET",async:!1,success:function(e){e.Parklot&&(o.rowCollection=e.Parklot,console.log(o.rowCollection),alert("success!"))}})},o.deleteLot=function(e){var t=confirm("确认删除？");1==t?(console.log("delete"),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parklot/"+e.id,method:"DELETE",async:!1,success:function(o){alert(" delete success"),o.message&&(console.log(o),alert("success!"))}}).done(function(){var t=o.rowCollection.indexOf(e);t!==-1&&o.rowCollection.splice(t,1)})):console.log("cancel")}}angular.module("RDash").controller("LotCtrl",["$scope","$state",LotCtrl]);
function MasterCtrl(t,e){var g=992;t.getWidth=function(){return window.innerWidth},t.$watch(t.getWidth,function(o,n){o>=g?angular.isDefined(e.get("toggle"))?t.toggle=!!e.get("toggle"):t.toggle=!0:t.toggle=!1}),t.toggleSidebar=function(){t.toggle=!t.toggle,e.put("toggle",t.toggle)},window.onresize=function(){t.$apply()}}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore",MasterCtrl]);
function OrderCtrl(e){function t(e){var t=e.getMonth()+1,o=e.getDate(),r=e.getHours(),l=e.getMinutes(),n=e.getSeconds();return"2016-"+t+"-"+o+"   "+r+":"+l+":"+n}e.listshow=!0,e.listMessage="收起",$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkrecord/",method:"GET",async:!1,success:function(o){o.Parkrecord&&(e.rowCollection=o.Parkrecord,e.ordernum=e.rowCollection.length,console.log(e.rowCollection),e.rowCollection&&e.rowCollection.forEach(function(e){e.entertime=t(new Date(Date.parse(e.entertime))),null==e.leavetime?e.leavetime="尚未离开":e.leavetime=t(new Date(Date.parse(e.leavetime)))}))}}),e.changeView=function(){e.listshow=!e.listshow,e.listshow?e.listMessage="收起":e.listMessage="显示"},e.search=function(){$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkrecord/",method:"GET",async:!1,success:function(o){o.Parkrecord&&(e.rowCollection=o.Parkrecord,console.log(e.rowCollection),e.rowCollection&&e.rowCollection.forEach(function(e){e.entertime=t(new Date(Date.parse(e.entertime))),null==e.leavetime?e.leavetime="尚未离开":e.leavetime=t(new Date(Date.parse(e.leavetime)))}),alert("success!"))}})}}angular.module("RDash").controller("OrderCtrl",["$scope","$cookieStore",OrderCtrl]);
function QRCtrl(o,e){o.myShow=!1,o.showQr=!0;var t=e.id;console.log(t),o.init=function(){var o=new QRCode(document.getElementById("qrcode"));o.makeCode(t.toString())},o.getCodeImg=function(){console.log(o.myCode);var e=new QRCode(document.getElementById("myqr"));e.makeCode(o.myCode),o.myShow=!0,o.showQr=!1}}angular.module("RDash").controller("QRCtrl",["$scope","$stateParams",QRCtrl]);
function SpaceCtrl(e,a,s){e.parkid=s.id,e.num=s.num,e.xnum=s.x,e.ynum=s.y,e.listshow=!0,e.listMessage="收起",0!=e.parkid&&$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkspace/?Parkspace.parkid="+e.parkid,method:"GET",async:!1,success:function(a){a.Parkspace&&(e.rowCollection=a.Parkspace,console.log(e.rowCollection))}}),e.changeView=function(){e.listshow=!e.listshow,e.listshow?e.listMessage="收起":e.listMessage="显示"},e.createSpace=function(){var a=1,s=1;if(console.log(e.xnum+","+e.ynum),e.parkid&&e.xnum&&e.ynum){for(a=1;a<=e.xnum;a++)for(s=1;s<=e.ynum;s++){var o={parkid:e.parkid,isfull:0,xpos:a,ypos:s};console.log(o),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkspace/",method:"POST",async:!1,data:JSON.stringify(o),contentType:"application/json",success:function(e){e&&console.log(e)}})}alert("创建完成")}else alert("关键信息为空！")},e.search=function(){e.listshow=!0,e.listMessage="收起",$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkspace/?Parkspace.parkid="+e.parkid,method:"GET",async:!1,success:function(a){a.Parkspace&&(e.rowCollection=a.Parkspace,console.log(e.rowCollection),alert("success!"))}})},e.spaceqrCode=function(e){a.go("qrCode",{id:e.id}),console.log(e.id)},e.seeCar=function(a){e.userid,0==a.isfull?alert("当前停车位没有停车！"):$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/Parkrecord/?Parkrecord.isleave=0&parkspaceid="+a.id,method:"GET",async:!1,success:function(a){a.Parkrecord&&(e.userid=a.Parkrecord[0].userid,console.log(a.Parkrecord[0]))}}).done(function(){console.log(e.userid),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/"+e.userid,method:"GET",async:!1,success:function(e){console.log(e),e&&(cartype=e.cartype,carid=e.carid,alert(cartype+","+carid))}})})}}angular.module("RDash").controller("SpaceCtrl",["$scope","$state","$stateParams",SpaceCtrl]);


function UserCtrl(e,s){e.showAlert=!0,e.closeAlert=function(){e.showAlert=!1},e.listshow=!0,e.listMessage="收起",$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/",method:"GET",async:!1,success:function(s){s.User&&(e.rowCollection=s.User,e.usernum=e.rowCollection.length,console.log(e.rowCollection))}}),e.changeView=function(){e.listshow=!e.listshow,e.listshow?e.listMessage="收起":e.listMessage="显示"},e.deleteUser=function(s){var o=confirm("确认删除？");1==o?(console.log("delete"),$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/"+s.id,method:"DELETE",async:!1,success:function(e){alert(" delete success"),e.message&&(console.log(e),alert("success!"))}}).done(function(){var o=e.rowCollection.indexOf(s);o!==-1&&e.rowCollection.splice(o,1)})):console.log("cancel")},e.search=function(){$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/",method:"GET",async:!1,success:function(s){s.User&&(e.rowCollection=s.User,console.log(e.rowCollection),alert("success!"))}})},e.createUser=function(){var o={username:e.create.username,phone:e.create.phone,password:e.create.password,cartype:e.create.cartype,carid:e.create.carid,money:0};console.log(o),o.username&&o.phone&&o.password&&o.cartype&&o.carid?$.ajax({url:"http://112.74.62.114:8080/Entity/Udb7fe87147e10/SZLKD/User/",method:"POST",async:!1,data:JSON.stringify(o),contentType:"application/json",success:function(e){e&&(console.log(e),alert("create user success!"),s.go("user"))}}):alert("关键信息为空！")}}angular.module("RDash").controller("UserCtrl",["$scope","$state",UserCtrl]);




function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"=?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);